<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>HWDPortalMaui</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="HWDPortalMaui.styles.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ğŸ—™</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å®šç¾©å…¨åŸŸçš„ showToast å‡½å¼
        window.showToast = (message, type) => {
            // æ ¹æ“šå‚³å…¥çš„ type æ±ºå®š icon å’ŒèƒŒæ™¯é¡è‰²
            const toastDetails = {
                success: { icon: 'bi-check-circle-fill', bgClass: 'bg-success' },
                danger: { icon: 'bi-x-circle-fill', bgClass: 'bg-danger' },
                warning: { icon: 'bi-exclamation-triangle-fill', bgClass: 'bg-warning' },
                info: { icon: 'bi-info-circle-fill', bgClass: 'bg-info' }
            };

            const details = toastDetails[type] || toastDetails.info; // å¦‚æœ type ç„¡æ•ˆï¼Œé è¨­ä½¿ç”¨ info
            const toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) return;

            // å‹•æ…‹å»ºç«‹ Toast çš„ HTML çµæ§‹
            const toastElement = document.createElement('div');
            toastElement.className = `toast align-items-center text-white ${details.bgClass} border-0`;
            toastElement.setAttribute('role', 'alert');
            toastElement.setAttribute('aria-live', 'assertive');
            toastElement.setAttribute('aria-atomic', 'true');

            toastElement.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="bi ${details.icon} me-2"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;

            // å°‡å»ºç«‹å¥½çš„ Toast å…ƒç´ åŠ å…¥åˆ°å®¹å™¨ä¸­
            toastContainer.appendChild(toastElement);

            // å»ºç«‹ Bootstrap Toast å¯¦ä¾‹ä¸¦é¡¯ç¤º
            const toast = new bootstrap.Toast(toastElement, {
                delay: 1000 // 1 ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
            });

            // ç›£è½ Toast é—œé–‰äº‹ä»¶ï¼Œä¸¦åœ¨é—œé–‰å¾Œå¾ DOM ä¸­ç§»é™¤å…ƒç´ ï¼Œé¿å…å…ƒç´ å †ç©
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });

            toast.show();
        };
        // èª¿æ•´å³éµé¸å–®ä½ç½®ï¼Œé¿å…è¶…å‡ºå¯è¦–ç¯„åœ
        function adjustContextMenuPosition() {
            // 1. æ‰¾åˆ° Blazor å‰›æ¸²æŸ“å‡ºä¾†çš„é¸å–®
            var menu = document.querySelector('.context-menu');
            if (!menu) {
                return; // å¦‚æœæ‰¾ä¸åˆ°é¸å–®ï¼Œå‰‡ä¸åŸ·è¡Œ
            }

            // 2. å–å¾—é¸å–®çš„å°ºå¯¸å’Œç•¶å‰è¦–çª—çš„é«˜åº¦
            var menuHeight = menu.offsetHeight;
            var menuWidth = menu.offsetWidth;
            var viewportHeight = window.innerHeight;
            var viewportWidth = window.innerWidth;

            // 3. å–å¾— Blazor è¨­å®šçš„åˆå§‹é»æ“Šä½ç½® (å¾ style è®€å–)
            var currentTop = parseInt(menu.style.top, 10);
            var currentLeft = parseInt(menu.style.left, 10);

            var newTop = currentTop;
            var newLeft = currentLeft;

            // 4. æª¢æŸ¥å‚ç›´æ˜¯å¦æº¢å‡º (æ ¸å¿ƒä¿®æ­£)
            // å¦‚æœ (é¸å–®çš„é ‚éƒ¨ + é¸å–®çš„é«˜åº¦) > è¦–çª—é«˜åº¦
            if (currentTop + menuHeight > viewportHeight) {
                // å°‡é¸å–®çš„é ‚éƒ¨ä½ç½®æ”¹ç‚º (è¦–çª—é«˜åº¦ - é¸å–®é«˜åº¦ - 5pxç·©è¡)
                newTop = viewportHeight - menuHeight - 5;

                // é¡å¤–è™•ç†ï¼šå¦‚æœé¸å–®æ¯”è¦–çª—é‚„é«˜ï¼Œè‡³å°‘è®“å®ƒå¾é ‚éƒ¨ 0 é–‹å§‹
                if (newTop < 0) {
                    newTop = 0;
                }
            }

            // 5. æª¢æŸ¥æ°´å¹³æ˜¯å¦æº¢å‡º (é¡å¤–å„ªåŒ–)
            if (currentLeft + menuWidth > viewportWidth) {
                // å°‡é¸å–®çš„å·¦å´ä½ç½®æ”¹ç‚º (è¦–çª—å¯¬åº¦ - é¸å–®å¯¬åº¦ - 5pxç·©è¡)
                newLeft = viewportWidth - menuWidth - 5;
                if (newLeft < 0) {
                    newLeft = 0;
                }
            }

            // 6. å¥—ç”¨è¨ˆç®—å¾Œçš„æœ€çµ‚ä½ç½®
            menu.style.top = newTop + 'px';
            menu.style.left = newLeft + 'px';
        }
    </script>

</body>

</html>